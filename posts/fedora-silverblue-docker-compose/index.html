<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Fedora Silverblue and Docker Compose &#183; Andy Rusiecki</title><meta name=title content="Fedora Silverblue and Docker Compose &#183; Andy Rusiecki"><meta name=description content="Getting Docker Compose up and running on Fedora Silverblue"><link rel=canonical href=https://andyrusiecki.dev/posts/fedora-silverblue-docker-compose/><link type=text/css rel=stylesheet href=/css/main.bundle.min.a7a271c076257286d30e17baa11cc09f9d9171e55a74721da847a09178fb0f05.css integrity="sha256-p6JxwHYlcobTDhe6oRzAn52RceVadHIdqEegkXj7DwU="><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3e80d0528c59616e7de9b0ca9316d9afd314b49ed9e5e6b88873731486ad67ee.js integrity="sha256-PoDQUoxZYW596bDKkxbZr9MUtJ7Z5ea4iHNzFIatZ+4=" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Fedora Silverblue and Docker Compose"><meta property="og:description" content="Getting Docker Compose up and running on Fedora Silverblue"><meta property="og:type" content="article"><meta property="og:url" content="https://andyrusiecki.dev/posts/fedora-silverblue-docker-compose/"><meta property="og:image" content="https://andyrusiecki.dev/posts/fedora-silverblue-docker-compose/feature.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-23T17:46:09+00:00"><meta property="article:modified_time" content="2022-11-23T17:46:09+00:00"><meta property="og:site_name" content="Andy Rusiecki"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://andyrusiecki.dev/posts/fedora-silverblue-docker-compose/feature.png"><meta name=twitter:title content="Fedora Silverblue and Docker Compose"><meta name=twitter:description content="Getting Docker Compose up and running on Fedora Silverblue"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Fedora Silverblue and Docker Compose","headline":"Fedora Silverblue and Docker Compose","description":"Getting Docker Compose up and running on Fedora Silverblue","abstract":"I\u0026rsquo;ve been playing with Fedora Silverblue on and off for the past few months, switching between it and Fedora Workstation on my current laptop.","inLanguage":"en","url":"https:\/\/andyrusiecki.dev\/posts\/fedora-silverblue-docker-compose\/","author":{"@type":"Person","name":"Andy Rusiecki"},"copyrightYear":"2022","dateCreated":"2022-11-23T17:46:09\u002b00:00","datePublished":"2022-11-23T17:46:09\u002b00:00","dateModified":"2022-11-23T17:46:09\u002b00:00","mainEntityOfPage":"true","wordCount":"892"}]</script><meta name=author content="Andy Rusiecki"><link href=https://github.com/andyrusiecki rel=me><link href=https://twitter.com/amgurs rel=me><link href=https://mastodon.social/@amgurs rel=me><link href=https://linkedin.com/in/andyrusiecki rel=me><link href=https://steamcommunity.com/id/amgurs rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-FR5C70WTFY"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FR5C70WTFY",{anonymize_ip:!1})}</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold pe-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral print:hidden sm:py-10"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Andy Rusiecki</a></div><ul class="flex list-none flex-col ltr:text-right rtl:text-left sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/posts/ title=Posts><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Fedora Silverblue and Docker Compose</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-11-23 17:46:09 +0000 UTC">November 23, 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">5 mins</span></div><div class="my-1 text-xs leading-relaxed text-neutral-500 dark:text-neutral-400"><a href=/topics/fedora-silverblue/ class="rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">Fedora Silverblue</a>
<a href=/topics/docker/ class="rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">Docker</a></div></div><div class=prose><img class="mb-6 -mt-4 rounded-md" srcset="/posts/fedora-silverblue-docker-compose/feature_hu7f9e183d24001b0da8019a8ae80f81eb_616861_330x0_resize_box_3.png 330w,/posts/fedora-silverblue-docker-compose/feature_hu7f9e183d24001b0da8019a8ae80f81eb_616861_660x0_resize_box_3.png 660w,/posts/fedora-silverblue-docker-compose/feature_hu7f9e183d24001b0da8019a8ae80f81eb_616861_1024x0_resize_box_3.png 1024w,/posts/fedora-silverblue-docker-compose/feature_hu7f9e183d24001b0da8019a8ae80f81eb_616861_1320x0_resize_box_3.png 2x" alt loading=lazy></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-prose grow"><p>I&rsquo;ve been playing with <a href=https://silverblue.fedoraproject.org/ target=_blank rel="noreferrer noopener">Fedora Silverblue</a> on and off for the past few months, switching between it and <a href=https://getfedora.org/en/workstation/ target=_blank rel="noreferrer noopener">Fedora Workstation</a> on my current laptop.</p><p>At first glance there isn&rsquo;t much of a difference between the two, both show a GNOME desktop environment that&rsquo;s almost identical. The main difference is that Fedora Silverblue is a variant of Fedora that uses an immutable base system.</p><p>The TL;DR for Silverblue is that you can&rsquo;t install packages as you would in Workstation. Instead you can install applications via <a href=https://flatpak.org/ target=_blank rel="noreferrer noopener">Flatpak</a>, from Fedora&rsquo;s repository or any other like <a href=https://flathub.org/home target=_blank rel="noreferrer noopener">Flathub</a>, or you can create a Toolbox, a Fedora based container where you can install packages just like in Workstation. These containers are run using <a href=https://podman.io/ target=_blank rel="noreferrer noopener">Podman</a> in the base system.</p><h2 id=what-if-i-need-docker class="relative group">What if I need Docker? <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#what-if-i-need-docker aria-label=Anchor>#</a></span></h2><p>In most cases, I&rsquo;ve found Podman to be a drop in replacement for <a href=https://www.docker.com/ target=_blank rel="noreferrer noopener">Docker</a>. The only real issue I ran into was when I wanted to use Docker Compose for local development. When a company&rsquo;s projects already have a workflow using Docker Compose, rewriting pieces of it to work with Podman isn&rsquo;t the best option.</p><p>I researched various ways to solve this issue, but the best solution I found was to use <code>docker-compose</code> within a toolbox in combination with <code>podman-remote</code> which can talk to the host&rsquo;s podman engine.</p><h2 id=how-to-get-docker-compose-working class="relative group">How to get Docker Compose working <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#how-to-get-docker-compose-working aria-label=Anchor>#</a></span></h2><p>For this walkthrough there are steps that are specific to the host and the toolbox container. Steps specifically for one or the other will be labeled with &ldquo;HOST:&rdquo; or &ldquo;TOOLBOX:&rdquo; to keep things clear.</p><p>If you don&rsquo;t already have a toolbox container ready you can easily create one with the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># using &#34;dev&#34; below as the container name</span>
</span></span><span class=line><span class=cl>toolbox create dev
</span></span></code></pre></div><h3 id=host-start-and-enable-the-podman-socket class="relative group">HOST: Start and Enable the Podman Socket <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#host-start-and-enable-the-podman-socket aria-label=Anchor>#</a></span></h3><p>In order for <code>podman-remote</code> to be able to connect to the host&rsquo;s podman engine we need to start the podman socket to allow communication between the host and toolbox container.</p><p>We can do this through systemd services, starting and enabling the podman socket with the <code>--user</code> argument as they don&rsquo;t need root access:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl --user <span class=nb>enable</span> podman.socket
</span></span><span class=line><span class=cl>systemctl --user start podman.socket
</span></span></code></pre></div><p>Afterwards take note of the socket used in the output of:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl --user status podman.socket
</span></span></code></pre></div><p>In my case the socket used is <code>unix:///run/user/1000/podman/podman.sock</code></p><h3 id=add-docker-host-environment-variable-to-bashrc-or-shell-configs class="relative group">Add Docker host environment variable to .bashrc or shell configs <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#add-docker-host-environment-variable-to-bashrc-or-shell-configs aria-label=Anchor>#</a></span></h3><p><code>docker-compose</code> will require a <code>DOCKER_HOST</code> environment variable set in order for it to use the podman socket we just set. For example, this line can be added to your <code>~/.bashrc</code> file if using a bash shell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>DOCKER_HOST</span><span class=o>=</span>unix:///run/user/1000/podman/podman.sock
</span></span></code></pre></div><h3 id=toolbox-install-podmandocker-dependencies class="relative group">TOOLBOX: Install podman/docker dependencies <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#toolbox-install-podmandocker-dependencies aria-label=Anchor>#</a></span></h3><p>Now we&rsquo;re ready to work inside our toolbox! Enter your toolbox and update existing packages if you haven&rsquo;t already:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># assuming &#34;dev&#34; is the toolbox name</span>
</span></span><span class=line><span class=cl>toolbox enter dev
</span></span><span class=line><span class=cl>sudo dnf update
</span></span></code></pre></div><p>Next we&rsquo;ll want to install <code>podman-remote</code> and <code>docker-compose</code>. <code>podman-remote</code> is basically the same as installing <code>podman</code> and always assuming we want to add the <code>--remote</code> argument. Using <code>podman-remote</code> here just makes this easier.
Then go to <code>/usr/bin/</code> and add symlinks for <code>podman</code> and <code>docker</code> pointing to <code>podman-remote</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dnf install -y podman-remote docker-compose
</span></span><span class=line><span class=cl>sudo ln -s /usr/bin/podman-remote /usr/bin/podman
</span></span><span class=line><span class=cl>sudo ln -s /usr/bin/podman-remote /usr/bin/docker
</span></span></code></pre></div><h3 id=selinux-issues class="relative group">SELinux issues <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#selinux-issues aria-label=Anchor>#</a></span></h3><p>If you have <code>Permission Denied</code> errors when running <code>docker-compose</code> now, it&rsquo;s likely due to SELinux. To bypass SELinux for containers add these lines to your <code>~/.config/containers/containers.conf</code> file (creating it if needed):</p><pre tabindex=0><code>[containers]
label = false
</code></pre><h3 id=optional-for-best-docker-compatibility class="relative group">Optional: For best Docker compatibility <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#optional-for-best-docker-compatibility aria-label=Anchor>#</a></span></h3><p>If you were previously used to Docker, you likely have Dockerfiles that reference images with unqualified names.</p><p>For example, when using Docker you could pull the latest Ubuntu image from Docker Hub with just <code>docker pull ubuntu:latest</code>. When we use <code>podman</code> it doesn&rsquo;t assume that we want to use Docker Hub so it may ask what repository we want to use when looking for the Ubuntu image. With Podman we need to use the fully qualified image name of <code>docker.io/library/ubuntu:latest</code>.</p><p>We can change this to be more like Docker (useful if working with scripts that assume docker usage) by creating a file at <code>~/.config/containers/registries.conf</code> with the following content:</p><pre tabindex=0><code>unqualified-search-registries = [&#34;docker.io&#34;]
</code></pre><h2 id=extra-getting-vs-code-connected-to-toolbox class="relative group">Extra: Getting VS Code connected to toolbox <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#extra-getting-vs-code-connected-to-toolbox aria-label=Anchor>#</a></span></h2><p>If using VS Code, I&rsquo;ve found getting it connected to a toolbox container to be a bit of a pain. You can use owtaylor&rsquo;s <a href=https://github.com/owtaylor/toolbox-vscode target=_blank rel="noreferrer noopener">Toolbox Visual Studio Code integration</a> tool, but in the end I preferred to simply install VS Code within the toolbox container so that no extra connection is necessary.</p><h3 id=install-vs-code-inside-toolbox class="relative group">Install VS Code inside toolbox <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#install-vs-code-inside-toolbox aria-label=Anchor>#</a></span></h3><p>In our toolbox we can simply install VS Code according to Microsoft&rsquo;s existing <a href=https://code.visualstudio.com/docs/setup/linux#_rhel-fedora-and-centos-based-distributions target=_blank rel="noreferrer noopener">Fedora Installation Instructions</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
</span></span><span class=line><span class=cl>sudo sh -c <span class=s1>&#39;echo -e &#34;[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc&#34; &gt; /etc/yum.repos.d/vscode.repo&#39;</span>
</span></span><span class=line><span class=cl>dnf check-update
</span></span><span class=line><span class=cl>sudo dnf install code
</span></span></code></pre></div><h3 id=create-desktop-entry-from-toolbox class="relative group">Create desktop entry from toolbox <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#create-desktop-entry-from-toolbox aria-label=Anchor>#</a></span></h3><p>Now we can start VS Code from the command line within the toolbox just fine, but what if we want to see the application in our launcher?</p><p>We&rsquo;ll first need to copy the <code>code.desktop</code> file from the toolbox container&rsquo;s <code>/usr/share/applications</code> to <code>~/.local/share/applications</code>. Then we&rsquo;ll need to edit the new copy, prepending each <code>Exec</code> command with <code>toolbox run --container dev</code> (again assuming your toolbox name is &ldquo;dev&rdquo; here).</p><p>We should now have a desktop entry appearing in our launcher, though the VS Code icon is missing. To fix this, we&rsquo;ll need to copy the icon file located in our toolbox at <code>/usr/share/pixmaps/com.visualstudio.code.png</code> to <code>~/.icons</code></p></div></section><footer class="pt-8 max-w-prose print:hidden"></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2023
Andy Rusiecki</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex h-12 w-12 items-center justify-center dark:hidden" title="Switch to dark appearance"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden h-12 w-12 items-center justify-center dark:flex" title="Switch to light appearance"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></footer></div></body></html>